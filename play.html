<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üèì Pong</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body {
    width: 100%; height: 100%;
    overflow: hidden;
    background: #0a0a1a;
    font-family: 'Courier New', monospace;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
  }
  #scoreboard {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 40px;
    padding: 10px 0;
    color: #fff;
    font-size: clamp(18px, 4vw, 36px);
    text-shadow: 0 0 10px rgba(255,255,255,0.5);
  }
  #scoreboard .label {
    font-size: clamp(10px, 2vw, 14px);
    color: #888;
    text-transform: uppercase;
    letter-spacing: 2px;
  }
  #scoreboard .score-group {
    text-align: center;
  }
  canvas {
    display: block;
    border: 2px solid #333;
    border-radius: 4px;
    background: #111122;
    box-shadow: 0 0 30px rgba(100, 100, 255, 0.1);
  }
  #message {
    color: #aaa;
    font-size: clamp(10px, 2vw, 14px);
    padding: 8px 0;
    text-align: center;
    min-height: 30px;
  }
</style>
</head>
<body>
<div id="scoreboard">
  <div class="score-group">
    <div class="label">Player üèì</div>
    <div id="p1score">0</div>
  </div>
  <div style="color:#444;">|</div>
  <div class="score-group">
    <div class="label">ü§ñ CPU</div>
    <div id="p2score">0</div>
  </div>
</div>
<canvas id="game"></canvas>
<div id="message">Move mouse or use ‚Üë‚Üì keys to control paddle. Click to start!</div>

<script type="module">
import * as Game from './js/game.js';

const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const p1ScoreEl = document.getElementById('p1score');
const p2ScoreEl = document.getElementById('p2score');
const messageEl = document.getElementById('message');

const uiCallbacks = {
  onScore: (player, score) => {
    if (player === 'p1') {
      p1ScoreEl.textContent = score;
      flashScore(p1ScoreEl);
    } else {
      p2ScoreEl.textContent = score;
      flashScore(p2ScoreEl);
    }
  },
  onGameOver: (winner) => {
    messageEl.textContent = winner + ' Click to play again.';
    p1ScoreEl.textContent = '0';
    p2ScoreEl.textContent = '0';
  }
};

function flashScore(el) {
  el.style.color = '#ff0';
  el.style.textShadow = '0 0 20px #ff0';
  setTimeout(() => {
    el.style.color = '#fff';
    el.style.textShadow = '0 0 10px rgba(255,255,255,0.5)';
  }, 300);
}

function draw() {
  const { W, H, paddleW, paddleH, ballSize, player, cpu, ball } = Game;
  ctx.clearRect(0, 0, W, H);

  // Center line
  ctx.setLineDash([H * 0.03, H * 0.02]);
  ctx.strokeStyle = '#333';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(W / 2, 0);
  ctx.lineTo(W / 2, H);
  ctx.stroke();
  ctx.setLineDash([]);

  // Center circle
  ctx.beginPath();
  ctx.arc(W / 2, H / 2, H * 0.12, 0, Math.PI * 2);
  ctx.strokeStyle = '#222';
  ctx.lineWidth = 1.5;
  ctx.stroke();

  // Paddles
  const radius = paddleW / 2;

  // Player paddle (blue glow)
  ctx.shadowColor = '#4488ff';
  ctx.shadowBlur = 15;
  ctx.fillStyle = '#6af';
  ctx.beginPath();
  ctx.roundRect(player.x, player.y, paddleW, paddleH, radius);
  ctx.fill();

  // CPU paddle (red glow)
  ctx.shadowColor = '#ff4444';
  ctx.fillStyle = '#f66';
  ctx.beginPath();
  ctx.roundRect(cpu.x, cpu.y, paddleW, paddleH, radius);
  ctx.fill();

  ctx.shadowBlur = 0;

  // Ball
  ctx.shadowColor = '#fff';
  ctx.shadowBlur = 12;
  ctx.fillStyle = '#fff';
  ctx.beginPath();
  ctx.arc(ball.x + ballSize / 2, ball.y + ballSize / 2, ballSize / 2, 0, Math.PI * 2);
  ctx.fill();
  ctx.shadowBlur = 0;

  // Ball trail effect
  ctx.globalAlpha = 0.15;
  ctx.fillStyle = '#fff';
  for (let i = 1; i <= 3; i++) {
    ctx.beginPath();
    ctx.arc(ball.x + ballSize / 2 - ball.dx * i * 0.5, ball.y + ballSize / 2 - ball.dy * i * 0.5, ballSize / 2 * (1 - i * 0.2), 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;
}

function loop() {
  Game.update(uiCallbacks);
  draw();
  requestAnimationFrame(loop);
}

function handleResize() {
  Game.resize(document.body.clientWidth, document.body.clientHeight, canvas);
}

function init() {
  handleResize();
  Game.setGameRunning(true);
  Game.resetBall(1);
  messageEl.textContent = '';
}

// Event listeners
window.addEventListener('resize', handleResize);

canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const { H } = Game;
  Game.setMouseY((e.clientY - rect.top) * (H / rect.height));
});

canvas.addEventListener('touchmove', (e) => {
  e.preventDefault();
  const rect = canvas.getBoundingClientRect();
  const { H } = Game;
  Game.setMouseY((e.touches[0].clientY - rect.top) * (H / rect.height));
}, { passive: false });

document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowUp') { Game.keys.up = true; e.preventDefault(); }
  if (e.key === 'ArrowDown') { Game.keys.down = true; e.preventDefault(); }
});

document.addEventListener('keyup', (e) => {
  if (e.key === 'ArrowUp') Game.keys.up = false;
  if (e.key === 'ArrowDown') Game.keys.down = false;
});

canvas.addEventListener('click', () => {
  if (!Game.gameRunning) init();
});

document.addEventListener('keydown', (e) => {
  if (e.key === ' ' && !Game.gameRunning) { init(); e.preventDefault(); }
});

handleResize();
Game.resetBall(1);
draw();
loop();
</script>
</body>
</html>
